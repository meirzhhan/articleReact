"use strict";(self.webpackChunkarticle_react=self.webpackChunkarticle_react||[]).push([[933],{3933:function(e,n,a){a.r(n),a.d(n,{default:function(){return q}});var r,t,o=a(4848),i=a(7767),l=a(7443),u=a(6540),c=a(1468),d=a(2389);!function(e){e.INCORRECT_USER_DATA="INCORRECT_USER_DATA",e.INCORRECT_AGE="INCORRECT_AGE",e.INCORRECT_COUNTRY="INCORRECT_COUNTRY",e.NO_DATA="NO_DATA",e.SERVER_ERROR="SERVER_ERROR"}(r||(r={})),function(e){e.KZT="KZT",e.EUR="EUR",e.USD="USD"}(t||(t={}));var s,f=a(3256),p=function(){return p=Object.assign||function(e){for(var n,a=1,r=arguments.length;a<r;a++)for(var t in n=arguments[a])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},p.apply(this,arguments)},h=[{value:t.KZT,content:t.KZT},{value:t.USD,content:t.USD},{value:t.EUR,content:t.EUR}],v=(0,u.memo)((function(e){var n=e.className,a=e.value,r=e.onChange,t=e.readonly,i=(0,d.Bd)("profile").t,l=(0,u.useCallback)((function(e){null==r||r(e)}),[r]),c={className:n,value:a,items:h,defaultValue:i("Укажите валюту"),label:i("Валюта"),onChange:l,readonly:t,direction:"top left"};return(0,o.jsx)(f.qF,p({},c))}));!function(e){e.Kazakhstan="Kazakhstan",e.Kyrgyzstan="Kyrgyzstan",e.Russia="Russia",e.Ukraine="Ukraine",e.Belarus="Belarus"}(s||(s={}));var y=function(){return y=Object.assign||function(e){for(var n,a=1,r=arguments.length;a<r;a++)for(var t in n=arguments[a])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},y.apply(this,arguments)},g=[{value:s.Kazakhstan,content:s.Kazakhstan},{value:s.Kyrgyzstan,content:s.Kyrgyzstan},{value:s.Ukraine,content:s.Ukraine},{value:s.Belarus,content:s.Belarus},{value:s.Russia,content:s.Russia}],C=(0,u.memo)((function(e){var n=e.value,a=e.onChange,r=e.readonly,t=(0,d.Bd)("profile").t,i=(0,u.useCallback)((function(e){null==a||a(e)}),[a]),l={onChange:i,value:n,defaultValue:t("Укажите страну"),label:t("Страна"),items:g,readonly:r,direction:"top left"};return(0,o.jsx)(f.qF,y({},l))})),b=a(114),m=a(8749),x=a(4018),j=a(3361),R=a(3422),E=a(5408),O=function(){return(0,o.jsx)(x.E,{width:"100%",height:38,border:"20px"})},w=function(e){var n=e.isLoading,a=e.error,r=e.className,t=e.data,i=e.readonly,l=e.onChangeFirstname,u=e.onChangeLastname,c=e.onChangeAge,s=e.onChangeCity,f=e.onChangeUsername,p=e.onChangeAvatar,h=e.onChangeCurrency,y=e.onChangeCountry,g=(0,d.Bd)("profile").t,w=(0,o.jsxs)(b.Z,{padding:"24",border:"partial",max:!0,columnGap:"32",children:[(0,o.jsx)(m.z,{maxWidth:!0,justify:"center",children:(0,o.jsx)(x.E,{border:"50%",width:128,height:128})}),(0,o.jsx)(m.z,{gap:"24",maxWidth:!0,children:[1,2].map((function(e){return(0,o.jsx)(m.T,{gap:"16",maxWidth:!0,children:[1,2,3,4].map((function(e){return(0,o.jsx)(O,{},e)}))},e)}))})]}),N=(0,o.jsx)(m.z,{justify:"center",maxWidth:!0,children:(0,o.jsx)(j.E,{variant:"error",title:g("Произошла ошибка при загрузке профиля"),text:g("Попробуйте обновить страницу"),align:"center"})});return n?w:a?N:(0,o.jsxs)(b.Z,{padding:"24",border:"partial",max:!0,className:r,columnGap:"32",children:[(null==t?void 0:t.avatar)&&(0,o.jsx)(m.z,{justify:"center",maxWidth:!0,children:(0,o.jsx)(R.e,{size:128,src:null==t?void 0:t.avatar})}),(0,o.jsxs)(m.z,{gap:"24",maxWidth:!0,children:[(0,o.jsxs)(m.T,{gap:"16",maxWidth:!0,children:[(0,o.jsx)(E.p,{value:null==t?void 0:t.first,label:g("Имя"),onChange:l,readonly:i,"data-testid":"ProfileCard.firstname"}),(0,o.jsx)(E.p,{value:null==t?void 0:t.lastname,label:g("Фамилия"),onChange:u,readonly:i,"data-testid":"ProfileCard.lastname"}),(0,o.jsx)(E.p,{value:null==t?void 0:t.age,label:g("Возраст"),onChange:c,readonly:i}),(0,o.jsx)(E.p,{value:null==t?void 0:t.city,label:g("Город"),onChange:s,readonly:i})]}),(0,o.jsxs)(m.T,{gap:"16",maxWidth:!0,children:[(0,o.jsx)(E.p,{value:null==t?void 0:t.username,label:g("Логин"),onChange:f,readonly:i}),(0,o.jsx)(E.p,{value:null==t?void 0:t.avatar,label:g("Аватар"),onChange:p,readonly:i}),(0,o.jsx)(v,{value:null==t?void 0:t.currency,onChange:h,readonly:i}),(0,o.jsx)(C,{value:null==t?void 0:t.country,onChange:y,readonly:i})]})]})]})},N=a(3286),T=a(9630),_=a(1893),k=a(5279),P=a(5307),A=function(e){var n;return null===(n=null==e?void 0:e.profile)||void 0===n?void 0:n.form},I=(0,P.zD)("profile/updateProfileData",(function(e,n){return a=void 0,t=void 0,i=function(){var e,a,t,o,i,l,u;return function(e,n){var a,r,t,o,i={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(u){return function(l){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(a=1,r&&(t=2&l[0]?r.return:l[0]?r.throw||((t=r.return)&&t.call(r),0):r.next)&&!(t=t.call(r,l[1])).done)return t;switch(r=0,t&&(l=[2&l[0],t.value]),l[0]){case 0:case 1:t=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((t=(t=i.trys).length>0&&t[t.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!t||l[1]>t[0]&&l[1]<t[3])){i.label=l[1];break}if(6===l[0]&&i.label<t[1]){i.label=t[1],t=l;break}if(t&&i.label<t[2]){i.label=t[2],i.ops.push(l);break}t[2]&&i.ops.pop(),i.trys.pop();continue}l=n.call(e,i)}catch(e){l=[6,e],r=0}finally{a=t=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,u])}}}(this,(function(c){switch(c.label){case 0:if(e=n.extra,a=n.rejectWithValue,t=n.getState,o=A(t()),(i=function(e){if(!e)return[r.NO_DATA];var n=e.first,a=e.lastname,t=e.age,o=e.country,i=[];return n&&a||i.push(r.INCORRECT_USER_DATA),t&&Number.isInteger(t)||i.push(r.INCORRECT_AGE),o||i.push(r.INCORRECT_COUNTRY),i}(o)).length)return[2,a(i)];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,e.api.put("/profile/".concat(null==o?void 0:o.id),o)];case 2:if(!(l=c.sent()).data)throw new Error;return[2,l.data];case 3:return u=c.sent(),console.log(u),[2,a([r.SERVER_ERROR])];case 4:return[2]}}))},new((o=void 0)||(o=Promise))((function(e,n){function r(e){try{u(i.next(e))}catch(e){n(e)}}function l(e){try{u(i.throw(e))}catch(e){n(e)}}function u(n){var a;n.done?e(n.value):(a=n.value,a instanceof o?a:new o((function(e){e(a)}))).then(r,l)}u((i=i.apply(a,t||[])).next())}));var a,t,o,i})),U=a(1300),S=(0,P.zD)("profile/fetchProfileData",(function(e,n){return a=void 0,r=void 0,o=function(){var a,r,t,o;return function(e,n){var a,r,t,o,i={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(u){return function(l){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(i=0)),i;)try{if(a=1,r&&(t=2&l[0]?r.return:l[0]?r.throw||((t=r.return)&&t.call(r),0):r.next)&&!(t=t.call(r,l[1])).done)return t;switch(r=0,t&&(l=[2&l[0],t.value]),l[0]){case 0:case 1:t=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!((t=(t=i.trys).length>0&&t[t.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!t||l[1]>t[0]&&l[1]<t[3])){i.label=l[1];break}if(6===l[0]&&i.label<t[1]){i.label=t[1],t=l;break}if(t&&i.label<t[2]){i.label=t[2],i.ops.push(l);break}t[2]&&i.ops.pop(),i.trys.pop();continue}l=n.call(e,i)}catch(e){l=[6,e],r=0}finally{a=t=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,u])}}}(this,(function(i){switch(i.label){case 0:a=n.extra,r=n.rejectWithValue,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,a.api.get((0,U.nL)(e))];case 2:if(!(t=i.sent()).data)throw new Error;return[2,t.data];case 3:return o=i.sent(),console.log(o),[2,r("error")];case 4:return[2]}}))},new((t=void 0)||(t=Promise))((function(e,n){function i(e){try{u(o.next(e))}catch(e){n(e)}}function l(e){try{u(o.throw(e))}catch(e){n(e)}}function u(n){var a;n.done?e(n.value):(a=n.value,a instanceof t?a:new t((function(e){e(a)}))).then(i,l)}u((o=o.apply(a,r||[])).next())}));var a,r,t,o})),W=function(){return W=Object.assign||function(e){for(var n,a=1,r=arguments.length;a<r;a++)for(var t in n=arguments[a])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},W.apply(this,arguments)},z=(0,P.Z0)({name:"profile",initialState:{readonly:!0,isLoading:!1,error:void 0,data:void 0,form:void 0,validateErrors:void 0},reducers:{setReadonly:function(e,n){e.readonly=n.payload},cancelEdit:function(e){e.readonly=!0,e.form=e.data,e.validateErrors=void 0},updateProfile:function(e,n){e.form=W(W({},e.form),n.payload)}},extraReducers:function(e){e.addCase(S.pending,(function(e){e.error=void 0,e.isLoading=!0})).addCase(S.fulfilled,(function(e,n){e.isLoading=!1,e.data=n.payload,e.form=n.payload})).addCase(S.rejected,(function(e,n){e.isLoading=!1,e.error=n.payload})).addCase(I.pending,(function(e){e.validateErrors=void 0,e.isLoading=!0})).addCase(I.fulfilled,(function(e,n){e.isLoading=!1,e.data=n.payload,e.form=n.payload,e.readonly=!0,e.validateErrors=void 0})).addCase(I.rejected,(function(e,n){e.isLoading=!1,e.validateErrors=n.payload}))}}),L=z.actions,D=z.reducer,B=function(e){var n;return null===(n=null==e?void 0:e.profile)||void 0===n?void 0:n.data},K=function(e){var n;return null===(n=e.profile)||void 0===n?void 0:n.readonly},F=(0,u.memo)((function(e){var n=e.className,a=(0,d.Bd)("profile").t,r=(0,T.j)(),t=(0,c.d4)(_.ed),i=(0,c.d4)(B),l=(0,c.d4)(K),s=(null==t?void 0:t.id)===(null==i?void 0:i.id),f=(0,u.useCallback)((function(){r(L.setReadonly(!1))}),[r]),p=(0,u.useCallback)((function(){r(L.cancelEdit())}),[r]),h=(0,u.useCallback)((function(){r(I())}),[r]);return(0,o.jsx)(b.Z,{padding:"24",max:!0,border:"partial",children:(0,o.jsxs)(m.z,{justify:"between",className:n,children:[(0,o.jsx)(j.E,{title:a("Профиль")}),s&&(0,o.jsx)(o.Fragment,{children:l?(0,o.jsx)(k.$,{onClick:f,"data-testid":"EditableProfileCardHeader.EditButton",children:a("Редактировать")}):(0,o.jsxs)(m.z,{gap:"8",children:[(0,o.jsx)(k.$,{onClick:p,"data-testid":"EditableProfileCardHeader.CancelButton",children:a("Отменить")}),(0,o.jsx)(k.$,{onClick:h,color:"success","data-testid":"EditableProfileCardHeader.SaveButton",children:a("Сохранить")})]})})]})})})),G=function(e){var n;return null===(n=e.profile)||void 0===n?void 0:n.isLoading},V=function(e){var n;return null===(n=e.profile)||void 0===n?void 0:n.error},Z=function(e){var n;return null===(n=e.profile)||void 0===n?void 0:n.validateErrors},Y={profile:D},H=(0,u.memo)((function(e){var n,a=e.className,t=e.id,i=(0,d.Bd)("profile").t,l=(0,T.j)(),s=(0,c.d4)(A),f=(0,c.d4)(G),p=(0,c.d4)(V),h=(0,c.d4)(K),v=(0,c.d4)(Z),y=((n={})[r.SERVER_ERROR]=i("Серверная ошибка"),n[r.INCORRECT_COUNTRY]=i("Некорректная страна"),n[r.NO_DATA]=i("Данные не указаны"),n[r.INCORRECT_USER_DATA]=i("Имя и фамилия обязательны"),n[r.INCORRECT_AGE]=i("Некорректный возраст"),n);(0,u.useEffect)((function(){t&&l(S(t))}),[l,t]);var g=(0,u.useCallback)((function(e){l(L.updateProfile({first:e||""}))}),[l]),C=(0,u.useCallback)((function(e){l(L.updateProfile({lastname:e||""}))}),[l]),b=(0,u.useCallback)((function(e){l(L.updateProfile({city:e||""}))}),[l]),x=(0,u.useCallback)((function(e){l(L.updateProfile({age:Number(e||0)}))}),[l]),R=(0,u.useCallback)((function(e){l(L.updateProfile({username:e||""}))}),[l]),E=(0,u.useCallback)((function(e){l(L.updateProfile({avatar:e||""}))}),[l]),O=(0,u.useCallback)((function(e){l(L.updateProfile({currency:e}))}),[l]),_=(0,u.useCallback)((function(e){l(L.updateProfile({country:e}))}),[l]);return(0,o.jsx)(N.H,{reducers:Y,children:(0,o.jsxs)(m.T,{gap:"16",maxWidth:!0,className:a,align:"center",children:[(0,o.jsx)(F,{}),(null==v?void 0:v.length)&&v.map((function(e){return(0,o.jsx)(j.E,{variant:"error",text:y[e],"data-testid":"EditableProfileCard.Error"},e)})),(0,o.jsx)(w,{data:s,isLoading:f,error:p,readonly:h,onChangeFirstname:g,onChangeLastname:C,onChangeAge:x,onChangeCity:b,onChangeUsername:R,onChangeAvatar:E,onChangeCurrency:O,onChangeCountry:_})]})})})),M=a(3974),q=function(e){var n=e.className,a=(0,i.g)().id;return(0,o.jsx)(l.Y,{"data-testid":"ProfilePage",className:(0,M.b)("",{},[n]),children:(0,o.jsx)(m.T,{maxWidth:!0,gap:"16",children:(0,o.jsx)(H,{id:a})})})}},3286:function(e,n,a){a.d(n,{H:function(){return i}});var r=a(4848),t=a(6540),o=a(1468),i=function(e){var n=e.children,a=e.reducers,i=e.removeAfterUnmount,l=void 0===i||i,u=(0,o.Pj)(),c=(0,o.wA)();return(0,t.useEffect)((function(){var e=u.reducerManager.getMountedReducers();return Object.entries(a).forEach((function(n){var a=n[0],r=n[1];e[a]||(u.reducerManager.add(a,r),c({type:"@INIT ".concat(a," reducer")}))})),function(){l&&Object.entries(a).forEach((function(e){var n=e[0];e[1],u.reducerManager.remove(n),c({type:"@UNMOUNT ".concat(n," reducer")})}))}}),[]),(0,r.jsx)(r.Fragment,{children:n})}},5408:function(e,n,a){a.d(n,{p:function(){return d}});var r=a(4848),t=a(6540),o=a(3974),i=a(8749),l=a(3361),u={InputWrapper:"LuFDUWoP",InputWrapper__input:"ery3YlX7",InputWrapper__addOnLeft:"Qvpr801k",InputWrapper__addOnRight:"FIvTSia7",s:"iqOIhKTe",m:"cUiCI1P9",l:"vgQzu3V8",withAddonLeft:"RwdSG5Ea",withAddonRight:"dr5QlRtl",focused:"NIL8h49X",readonly:"fTN1PnWu"},c=function(){return c=Object.assign||function(e){for(var n,a=1,r=arguments.length;a<r;a++)for(var t in n=arguments[a])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},c.apply(this,arguments)},d=(0,t.memo)((function(e){var n,a=e.className,d=e.value,s=e.onChange,f=e.type,p=void 0===f?"text":f,h=e.placeholder,v=e.autofocus,y=e.readonly,g=e.addonLeft,C=e.addonRight,b=e.label,m=e.size,x=void 0===m?"m":m,j=function(e,n){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var t=0;for(r=Object.getOwnPropertySymbols(e);t<r.length;t++)n.indexOf(r[t])<0&&Object.prototype.propertyIsEnumerable.call(e,r[t])&&(a[r[t]]=e[r[t]])}return a}(e,["className","value","onChange","type","placeholder","autofocus","readonly","addonLeft","addonRight","label","size"]),R=(0,t.useRef)(null),E=(0,t.useState)(!1),O=E[0],w=E[1];(0,t.useEffect)((function(){var e;v&&(w(!0),null===(e=R.current)||void 0===e||e.focus())}),[v]);var N=((n={})[u.readonly]=y,n[u.focused]=O,n[u.withAddonLeft]=Boolean(g),n[u.withAddonRight]=Boolean(C),n),T=(0,r.jsxs)("div",{className:(0,o.b)(u.InputWrapper,N,[a,u[x]]),children:[(0,r.jsx)("div",{className:u.InputWrapper__addOnLeft,children:g}),(0,r.jsx)("input",c({className:u.InputWrapper__input,ref:R,type:p,value:d,onChange:function(e){null==s||s(e.target.value)},onFocus:function(){w(!0)},onBlur:function(){w(!1)},readOnly:y,placeholder:h},j)),(0,r.jsx)("div",{className:u.InputWrapper__addOnRight,children:C})]});return b?(0,r.jsxs)(i.z,{maxWidth:!0,gap:"8",children:[(0,r.jsx)(l.E,{text:b}),T]}):T}))}}]);